<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Running the pSConfig MaDDash Agent &mdash; perfSONAR Toolkit 4.1b1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/perfsonar.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '4.1b1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="perfSONAR Toolkit 4.1b1 documentation" href="index.html" />
    <link rel="next" title="pSConfig Administrative GUI" href="mca.html" />
    <link rel="prev" title="Running the pSConfig pScheduler Agent" href="psconfig_pscheduler_agent.html" /> 
  </head>
  <body>
    <header>
        <div class="headerContents">
          <a href="index.html" border="0"><img src="_static/perfSONAR-header.gif"></a>
          <div class="acctSearchContainer">
              <section id="searchBox" class="searchBox">
                  <!--Use of this code assumes agreement with the Google Custom Search Terms of Service. -->
                  <!--The terms of service are available at http://www.google.com/cse/docs/tos.html -->
                  <form action="search.html" id="cse-search-box" method="get">
                    <input type="text" name="q" size="25" class="searchInput" placeholder="Search"/>
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                  </form>
              </section>
         </div>
        </div>
    </header>
    <div style="display:block;clear:both;">
    
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mca.html" title="pSConfig Administrative GUI"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="psconfig_pscheduler_agent.html" title="Running the pSConfig pScheduler Agent"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">perfSONAR Toolkit 4.1b1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    </div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="running-the-psconfig-maddash-agent">
<h1>Running the pSConfig MaDDash Agent<a class="headerlink" href="#running-the-psconfig-maddash-agent" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<span id="psconfig-maddash-agent-intro"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="psconfig-maddash-agent-s-role">
<span id="psconfig-maddash-agent-intro-role"></span><h3>pSConfig MaDDash Agent&#8217;s Role<a class="headerlink" href="#psconfig-maddash-agent-s-role" title="Permalink to this headline">¶</a></h3>
<p>The role of the <em>pSConfig MaDDash Agent</em> is to read <a class="reference internal" href="psconfig_intro.html"><em>pSConfig templates</em></a> and generate a set of grids to be displayed by MaDDash. It does this by updating the primary MaDDash configuration file, <tt class="docutils literal"><span class="pre">maddash.yaml</span></tt>. The diagram below describes this role:</p>
<div class="figure align-center">
<img alt="_images/psconfig_maddash_agent-arch.png" src="_images/psconfig_maddash_agent-arch.png" />
<p class="caption"><em>A diagram showing the psconfig-maddash-agent reading templates from a number of sources and generating a MaDDash configuration file.</em></p>
</div>
<p>Performing this role is a multi-step process that includes the following:</p>
<ol class="arabic simple">
<li>Read the configured templates and optionally apply local modifications</li>
<li>Determine how to display tasks</li>
<li>Generate a <tt class="docutils literal"><span class="pre">maddash.yaml</span></tt> file</li>
</ol>
<p>These steps are completed anytime one of the following events occur:</p>
<ul class="simple">
<li>The agent starts</li>
<li>Within a configurable amount of time of a change to a <em>local</em> configuration file (changes to remote templates are not detected). By default the value is <em>1 minute</em>.</li>
<li>If no changes, on a configurable interval after the start of the last run. By default these steps are run every <em>1 hour</em>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See <a class="reference internal" href="#psconfig-maddash-agent-advanced"><em>Advanced Configuration</em></a> for more detail on the configuration options mentioned above.</p>
</div>
<p>The remainder of this section describes each of these steps in greater detail.</p>
</div>
<div class="section" id="reading-and-modifying-templates">
<span id="psconfig-maddash-agent-intro-read"></span><h3>Reading and Modifying Templates<a class="headerlink" href="#reading-and-modifying-templates" title="Permalink to this headline">¶</a></h3>
<p>The agents first job is to read a set of <a class="reference internal" href="psconfig_templates_intro.html"><em>templates</em></a>. The templates to read are configured by the administrator of the agent. For information on how to configure templates see <a class="reference internal" href="#psconfig-maddash-agent-templates"><em>Configuring Templates</em></a>.</p>
<p>After reading a template, an agent is also capable of performing local modifications. See <a class="reference internal" href="#psconfig-maddash-agent-modify"><em>Modifying Templates</em></a> for more details.</p>
</div>
<div class="section" id="determining-how-to-display-tasks">
<span id="psconfig-maddash-agent-intro-match"></span><h3>Determining How to Display Tasks<a class="headerlink" href="#determining-how-to-display-tasks" title="Permalink to this headline">¶</a></h3>
<p>After reading the templates, the agent needs to decide how to display the task topology in MaDDash. This decision includes:</p>
<ul class="simple">
<li>Selecting which tasks to display</li>
<li>Selecting how to analyze results</li>
<li>Selecting how to visualize results</li>
<li>Setting custom thresholds and other parameters</li>
</ul>
<p>In <a class="reference internal" href="#psconfig-maddash-agent-grids"><em>Configuring Grids</em></a> the process of defining how to display the tasks is detailed.</p>
</div>
<div class="section" id="generating-the-maddash-yaml-file">
<span id="psconfig-maddash-agent-intro-generate"></span><h3>Generating the <tt class="docutils literal"><span class="pre">maddash.yaml</span></tt> file<a class="headerlink" href="#generating-the-maddash-yaml-file" title="Permalink to this headline">¶</a></h3>
<p>After determining what to display, the agent outputs the result to <tt class="docutils literal"><span class="pre">/etc/maddash/maddash-server/maddash.yaml</span></tt> by default. At that point, MaDDash takes over and will detect the change within 60 seconds by default. Shortly thereafter visiting the MaDDash web interface should show the changes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The agent runs as the <em>maddash</em> user since this account owns the <tt class="docutils literal"><span class="pre">maddash.yaml</span></tt> file. This is contrast to many other perfsonar services that run as the <em>perfsonar</em> user or a user named for the component. This also impacts the owner and location of log files as detailed in <a class="reference internal" href="#psconfig-maddash-agent-troubleshoot-logs"><em>Reading the Logs</em></a>.</p>
</div>
</div>
</div>
<div class="section" id="installation">
<span id="psconfig-maddash-agent-install"></span><h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="installing-the-standalone-package">
<span id="psconfig-maddash-agent-standalone"></span><h3>Installing the Standalone Package<a class="headerlink" href="#installing-the-standalone-package" title="Permalink to this headline">¶</a></h3>
<p>The pSConfig MaDDash agent is installed with the package <tt class="docutils literal"><span class="pre">perfsonar-psconfig-maddash</span></tt>. You can run the following commands to install it:</p>
<blockquote>
<div><p><em>CentOS</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>yum install perfsonar-psconfig-maddash
</pre></div>
</div>
<p><em>Debian/Ubuntu</em>:</p>
<div class="highlight-python"><div class="highlight"><pre>apt-get install perfsonar-psconfig-maddash
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="installing-as-part-of-a-bundle">
<span id="psconfig-maddash-agent-bundle"></span><h3>Installing as Part of a Bundle<a class="headerlink" href="#installing-as-part-of-a-bundle" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">perfsonar-psconfig-maddash</span></tt> is included in the following <a class="reference internal" href="install_options.html"><em>perfSONAR bundles</em></a>:</p>
<ul class="simple">
<li><em>perfsonar-centralmanagement</em></li>
</ul>
</div>
</div>
<div class="section" id="running-psconfig-maddash-agent">
<span id="psconfig-maddash-agent-run"></span><h2>Running <tt class="docutils literal"><span class="pre">psconfig-maddash-agent</span></tt><a class="headerlink" href="#running-psconfig-maddash-agent" title="Permalink to this headline">¶</a></h2>
<div class="section" id="starting-psconfig-maddash-agent">
<span id="psconfig-maddash-agent-run-start"></span><h3>Starting <tt class="docutils literal"><span class="pre">psconfig-maddash-agent</span></tt><a class="headerlink" href="#starting-psconfig-maddash-agent" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>systemctl start psconfig-maddash-agent
</pre></div>
</div>
</div>
<div class="section" id="stopping-psconfig-maddash-agent">
<span id="psconfig-maddash-agent-run-stop"></span><h3>Stopping <tt class="docutils literal"><span class="pre">psconfig-maddash-agent</span></tt><a class="headerlink" href="#stopping-psconfig-maddash-agent" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>systemctl stop psconfig-maddash-agent
</pre></div>
</div>
</div>
<div class="section" id="restarting-psconfig-maddash-agent">
<span id="psconfig-maddash-agent-run-restart"></span><h3>Restarting <tt class="docutils literal"><span class="pre">psconfig-maddash-agent</span></tt><a class="headerlink" href="#restarting-psconfig-maddash-agent" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>systemctl restart psconfig-maddash-agent
</pre></div>
</div>
</div>
<div class="section" id="checking-the-status-of-psconfig-maddash-agent">
<span id="psconfig-maddash-agent-run-status"></span><h3>Checking the status of <tt class="docutils literal"><span class="pre">psconfig-maddash-agent</span></tt><a class="headerlink" href="#checking-the-status-of-psconfig-maddash-agent" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>systemctl status psconfig-maddash-agent
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuring-templates">
<span id="psconfig-maddash-agent-templates"></span><h2>Configuring Templates<a class="headerlink" href="#configuring-templates" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configuration-basics">
<span id="psconfig-maddash-agent-templates-basics"></span><h3>Configuration Basics<a class="headerlink" href="#configuration-basics" title="Permalink to this headline">¶</a></h3>
<p>In order for the agent to configure MaDDash, it must first be configured to read one or more templates. There are multiple ways to add a template depending on its location relative to the host system of the agent. These include:</p>
<ol class="arabic simple">
<li>Configuring <em>remote</em> templates  by supplying a URL and desired options to the agent. This is most commonly done using the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">remote</span></tt> command. See <a class="reference internal" href="#psconfig-maddash-agent-templates-remote"><em>Remote Templates</em></a> for details.</li>
<li>Configuring <em>local</em> templates that live on the agent&#8217;s filesystem either using the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">remote</span></tt> command or by copying the template files to a dedicated directory whose contents are automatically read by the agent. See <a class="reference internal" href="#psconfig-maddash-agent-templates-local"><em>Local Templates</em></a> for details.</li>
</ol>
</div>
<div class="section" id="remote-templates">
<span id="psconfig-maddash-agent-templates-remote"></span><h3>Remote Templates<a class="headerlink" href="#remote-templates" title="Permalink to this headline">¶</a></h3>
<p>The primary way to add, list, and delete the remote templates read by the agent is with the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">remote</span></tt> command.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">remote</span></tt> command simply edits the <tt class="docutils literal"><span class="pre">/etc/perfsonar/psconfig/maddash-agent.json</span></tt> file. For most users it is recommended to use the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">remote</span></tt> command as opposed to editing the file directly as it is less prone to syntax errors.</p>
</div>
<p>As an example let&#8217;s say we have a pSConfig template at the URL <tt class="docutils literal"><span class="pre">https://10.0.0.1/example.json</span></tt>. The agent can be configured to read the template by running the following command <strong>as a root user</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>psconfig remote add &quot;https://10.0.0.1/example.json&quot;
</pre></div>
</div>
<p>The above command will add the new template to the agent. The agent should begin reading the template within 60 seconds of the change if using default settings (i.e. no agent restart required).</p>
<p>You may also provide the command with additional processing instructions. To see the full set of options available run the following:</p>
<div class="highlight-python"><div class="highlight"><pre>psconfig remote --help
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unlike the <a class="reference internal" href="psconfig_pscheduler_agent.html"><em>pSConfig pScheduler Agent</em></a>, the MaDDash agent will use archive definitions from templates with no extra options like <tt class="docutils literal"><span class="pre">--configure-archives</span></tt>. This is because MaDDash ultimately just uses the archives for <em>reading</em> data as opposed to <em>writing</em> results. Also, the agent would not be particularly useful otherwise since you cannot display results if you do not have them.</p>
</div>
<p>In addition to adding remote templates, you may also view them. The following command lists the remote templates in use by the agent:</p>
<div class="highlight-python"><div class="highlight"><pre>psconfig remote list
</pre></div>
</div>
<p>The above command returns a list of JSON objects containing the template URL and any options set.</p>
<p>Finally, to remove our example remote template we can run the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">remote</span> <span class="pre">delete</span></tt> command <strong>as a root user</strong> as shown below:</p>
<div class="highlight-python"><div class="highlight"><pre>psconfig remote delete &quot;https://10.0.0.1/example.json&quot;
</pre></div>
</div>
<p>The command accepts only a URL and will remove the agent&#8217;s pointer to that template. Within 60 seconds of executing that command, the agent will run and instruct MaDDash to cease display of any tasks from the removed template.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">remote</span></tt> command is also the command used by the <a class="reference internal" href="psconfig_pscheduler_agent.html"><em>pScheduler agent</em></a> to manage remote templates. If you have both agents installed on the same system, then any <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">remote</span></tt> command will affect both agents by default. If you&#8217;d only like a command to apply to the MaDDash agent then add the <tt class="docutils literal"><span class="pre">--agent</span> <span class="pre">maddash</span></tt> option. Run <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">remote</span> <span class="pre">--help</span></tt> for full details.</p>
</div>
</div>
<div class="section" id="local-templates">
<span id="psconfig-maddash-agent-templates-local"></span><h3>Local Templates<a class="headerlink" href="#local-templates" title="Permalink to this headline">¶</a></h3>
<p>The agent can read templates from the local filesystem. One way to do this is by giving the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">remote</span></tt> command either a URL beginning with <tt class="docutils literal"><span class="pre">file://</span></tt> or an absolute path to the file on the filesystem. An example command is below where <tt class="docutils literal"><span class="pre">/path/to/template.json</span></tt> is the example path to the template file:</p>
<div class="highlight-python"><div class="highlight"><pre>psconfig remote add /path/to/template.json
</pre></div>
</div>
<p>Everything about the command works the same with a file path as it would with a http/https URL. See <a class="reference internal" href="#psconfig-maddash-agent-templates-remote"><em>Remote Templates</em></a> for more details on this command.</p>
<p>A second way you can add a local template is to copy it into the <em>template include directory</em>. By default this is located at <tt class="docutils literal"><span class="pre">/etc/perfsonar/psconfig/maddash.d/</span></tt>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cp</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">template</span><span class="o">.</span><span class="n">json</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">perfsonar</span><span class="o">/</span><span class="n">psconfig</span><span class="o">/</span><span class="n">maddash</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">template</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Any file ending with <tt class="docutils literal"><span class="pre">.json</span></tt> in this directory will get read by the agent automatically. Some important notes about including files in this manner:</p>
<ul class="simple">
<li>Adding a new file, removing a file or updating a file within the template include directory will get detected automatically by the agent within 60 seconds of the change (i.e. no need to restart the agent).</li>
<li>Files are read every 60 minutes regardless of changes when the agent checks on the state of the grids it has created in MaDDash.</li>
<li>The agent will follow symlinks if you use those instead of copying the file directly, though it may affect the agent&#8217;s ability to detect changes (i.e. you may have to wait up to 60 minutes for the agent to see the changes).</li>
<li>The agent ignores any files that do not end in <tt class="docutils literal"><span class="pre">.json</span></tt></li>
</ul>
</div>
</div>
<div class="section" id="modifying-templates">
<span id="psconfig-maddash-agent-modify"></span><h2>Modifying Templates<a class="headerlink" href="#modifying-templates" title="Permalink to this headline">¶</a></h2>
<p>Template modification in the MaDDash agent works exactly the same as in the pScheduler agent. They both use the same commands and directories to perform these operations. See <a class="reference internal" href="psconfig_pscheduler_agent.html#psconfig-pscheduler-agent-modify"><em>Modifying Templates</em></a> in the pScheduler agent document for full details.</p>
</div>
<div class="section" id="configuring-grids">
<span id="psconfig-maddash-agent-grids"></span><h2>Configuring Grids<a class="headerlink" href="#configuring-grids" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-is-a-grid">
<span id="psconfig-maddash-agent-grids-intro"></span><h3>What is a grid?<a class="headerlink" href="#what-is-a-grid" title="Permalink to this headline">¶</a></h3>
<p>After reading the templates, the agent needs to decide how to display the results produced by the task topology in MaDDash. Displaying the results requires specific instructions to be given to the agent with regards to which tasks to display and how to display them. By default the agent knows nothing about specific test types nor what to tell MaDDash to do with them. In order for it to translate a task to someting displayable it needs additional information.</p>
<p>First of all it needs to associate a task from the template with a <strong>check</strong>. A <em>check</em> is an action to perform that generates a result for MaDDash to display. It consists of a command to run and additional information such as a URL to a graph. Usually this command takes the form of a nagios command since that is what MaDDash knows how to run. Building these commands manually is cumbersome so the pSConfig MaDDash agent ships with a number of <strong>check plug-ins</strong>. These plug-ins define the types of tasks they understand, the types of archives they know how to read  and ultimately use this information map the task parameters into a command-line template that can be stored in <tt class="docutils literal"><span class="pre">maddash.yaml</span></tt>. Note that the agent DOES NOT run this command, it simply builds the command tenplate string for MaDDash to run.</p>
<p>The <em>check</em> also needs to be associated with a <strong>visualization</strong>. A <em>visualization</em> is a URL that points at more information about a task&#8217;s result. More specifically this is the graph displayed when a cell is clicked in the MaDDash web interface. This URL may also contain parameters needed to grab the results of the test. Similar to checks, the agent includes <strong>visualization-plugins</strong> that build the URL based on the contents of a task.</p>
<p>Finally, these two concepts are brought together into a <strong>grid</strong>. A <em>grid</em> is the unit of configuration that instructs the agent how to convert pSConfig template tasks into something MaDDash can display. It consists of a check plugin, a visualization plug-in and any desired customizations allowed by each. Potential customizations include task selection criteria, check thresholds and many other parameters. The name grid stems from the fact that it ultimately translates a pSConfig <em>task</em> object into the grid representation fundamental to MaDDash.</p>
<p>This is a fair amount of terminology but the MaDDash agent provides configuration utilities that hopefully allows you to ignore or explore as much detail as you want. The remainder of this section is about how to configure grids with these utilities.</p>
</div>
<div class="section" id="introduction-to-the-psconfig-maddash-grid-command">
<span id="psconfig-maddash-agent-grids-cmd"></span><h3>Introduction to the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">maddash-grid</span></tt> command<a class="headerlink" href="#introduction-to-the-psconfig-maddash-grid-command" title="Permalink to this headline">¶</a></h3>
<p>Grids are configured using the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">maddash-grid</span></tt> command. By default, your agent comes pre-configured with some common grid definitions. You can view them with the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>psconfig maddash-grid list
</pre></div>
</div>
<p>This should lead to the following output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
   <span class="s">&quot;default_ping_loss&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;priority&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;group&quot;</span> <span class="p">:</span> <span class="s">&quot;ping_loss&quot;</span><span class="p">,</span>
         <span class="s">&quot;level&quot;</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="s">&quot;check&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;ps-nagios-ping-loss&quot;</span>
      <span class="p">},</span>
      <span class="s">&quot;visualization&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;ps-graphs&quot;</span>
      <span class="p">},</span>
      <span class="s">&quot;display-name&quot;</span> <span class="p">:</span> <span class="s">&quot;Ping Loss&quot;</span>
   <span class="p">},</span>
   <span class="s">&quot;default_trace&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;priority&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;group&quot;</span> <span class="p">:</span> <span class="s">&quot;trace&quot;</span><span class="p">,</span>
         <span class="s">&quot;level&quot;</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="s">&quot;check&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;ps-nagios-traceroute&quot;</span>
      <span class="p">},</span>
      <span class="s">&quot;visualization&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;ps-traceroute-viewer&quot;</span>
      <span class="p">},</span>
      <span class="s">&quot;display-name&quot;</span> <span class="p">:</span> <span class="s">&quot;Path Count&quot;</span>
   <span class="p">},</span>
   <span class="s">&quot;default_loss&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;priority&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;group&quot;</span> <span class="p">:</span> <span class="s">&quot;loss&quot;</span><span class="p">,</span>
         <span class="s">&quot;level&quot;</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="s">&quot;check&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;ps-nagios-loss&quot;</span>
      <span class="p">},</span>
      <span class="s">&quot;visualization&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;ps-graphs&quot;</span>
      <span class="p">},</span>
      <span class="s">&quot;display-name&quot;</span> <span class="p">:</span> <span class="s">&quot;Loss&quot;</span>
   <span class="p">},</span>
   <span class="s">&quot;default_throughput&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;priority&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;group&quot;</span> <span class="p">:</span> <span class="s">&quot;throughput&quot;</span><span class="p">,</span>
         <span class="s">&quot;level&quot;</span> <span class="p">:</span> <span class="mi">1</span>
      <span class="p">},</span>
      <span class="s">&quot;check&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;ps-nagios-throughput&quot;</span>
      <span class="p">},</span>
      <span class="s">&quot;visualization&quot;</span> <span class="p">:</span> <span class="p">{</span>
         <span class="s">&quot;type&quot;</span> <span class="p">:</span> <span class="s">&quot;ps-graphs&quot;</span>
      <span class="p">},</span>
      <span class="s">&quot;display-name&quot;</span> <span class="p">:</span> <span class="s">&quot;Throughput&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If these grids fit your needs, you may not need to do any further configuration.</p>
<p>The command requires three parameters as shown in the example below:</p>
<div class="highlight-python"><div class="highlight"><pre>psconfig maddash-grid add --name example_loss --check-type ps-nagios-loss --visualization-type ps-graphs
</pre></div>
</div>
<p>The meaning of each parameters is as follows:</p>
<ul class="simple">
<li>The <em>&#8211;name</em> is used to identify the check if later modifying the check. Only letters, numbers, hyphens(-), colons(:) and periods (.) are allows in the name. No whitespace or other specical characters. This value  will be used in the name displayed if the <tt class="docutils literal"><span class="pre">--display-name</span></tt> option is not provided. In the example the check will be referred to as <tt class="docutils literal"><span class="pre">example_loss</span></tt>.</li>
<li>The <em>&#8211;check-type</em> indicates the check plug-in to use. The <tt class="docutils literal"><span class="pre">ps-nagios-loss</span></tt> plug-in is selected in the example. That is a check that by default queries an esmond server for loss data from tasks with test type <em>latency</em> or <em>latencybg</em>. If you specify an invalid plug-in the tool gives an error and lists the valid plug-ins. See <a class="reference internal" href="#psconfig-maddash-agent-grids-checks"><em>Determining Check Plug-ins Installed</em></a> for determining the list of plug-ins installed and how to get more info.</li>
<li>The <em>&#8211;visualization-type</em> indicates the visualization plug-in to use. In the example <tt class="docutils literal"><span class="pre">ps-graphs</span></tt> is used which is the standard perfSONAR graphs that can query esmond for throughput, latency, and loss information. If you specify an invalid plug-in the tool gives an error and lists the valid plug-ins. See <a class="reference internal" href="#psconfig-maddash-agent-grids-viz"><em>Determining Visualization Plug-ins Installed</em></a> for determining the list of plug-ins installed and how to get more info.</li>
</ul>
</div>
<div class="section" id="determining-check-plug-ins-installed">
<span id="psconfig-maddash-agent-grids-checks"></span><h3>Determining Check Plug-ins Installed<a class="headerlink" href="#determining-check-plug-ins-installed" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="determining-visualization-plug-ins-installed">
<span id="psconfig-maddash-agent-grids-viz"></span><h3>Determining Visualization Plug-ins Installed<a class="headerlink" href="#determining-visualization-plug-ins-installed" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="adjusting-grid-thresholds-and-other-parameters">
<span id="psconfig-maddash-agent-grids-thresholds"></span><h3>Adjusting Grid Thresholds and Other Parameters<a class="headerlink" href="#adjusting-grid-thresholds-and-other-parameters" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="understanding-grid-priorities">
<span id="psconfig-maddash-agent-grids-prios"></span><h3>Understanding Grid Priorities<a class="headerlink" href="#understanding-grid-priorities" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="controlling-the-display-name">
<span id="psconfig-maddash-agent-grids-display"></span><h3>Controlling the Display Name<a class="headerlink" href="#controlling-the-display-name" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="troubleshooting">
<span id="psconfig-maddash-agent-troubleshoot"></span><h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="looking-at-the-last-run-with-psconfig-maddash-stats">
<span id="psconfig-maddash-agent-troubleshoot-stats"></span><h3>Looking at the last run with <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">maddash-stats</span></tt><a class="headerlink" href="#looking-at-the-last-run-with-psconfig-maddash-stats" title="Permalink to this headline">¶</a></h3>
<p>One of the first steps to perform when debugging the pSConfig MaDDash agent is to get information about the last time the agent ran. A run in this context describes an instance when the agent downloaded all the templates it is configured to use, made any local modifications, matched task to configured grids and output the <tt class="docutils literal"><span class="pre">maddash.yaml</span></tt> file. As described in <a class="reference internal" href="#psconfig-maddash-agent-intro-role"><em>pSConfig MaDDash Agent&#8217;s Role</em></a>, a run can be triggered by the passing of a set time interval (60 minutes by default) or a configuration file change.</p>
<p>Rather than manually digging through logs, pSConfig provides a tool for parsing summary information about the last run in the form of the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">maddash-stats</span></tt> command. The command does not require any options and is shown below:</p>
<div class="highlight-python"><div class="highlight"><pre>psconfig maddash-stats
</pre></div>
</div>
<p>Below is an example of the successful output:</p>
<div class="highlight-python"><div class="highlight"><pre>Agent Last Run Start Time: 2018/04/25 15:38:48
Agent Last Run End Time: 2018/04/25 15:38:49
Agent Last Run Process ID (PID): 3751
Agent Last Run Log GUID: BF30C416-489E-11E8-8BB6-530A118410B6
Total grids managed by agent: 8
From include files: 5
    /etc/perfsonar/psconfig/maddash.d/template.json: 5
From remote definitions: 3
    http://10.0.0.1/demo.json: 3
</pre></div>
</div>
<p>The output fields can be described as follows:</p>
<ul class="simple">
<li><strong>Agent Last Run Start Time</strong> is the time when the agent began its last complete run.</li>
<li><strong>Agent Last Run End Time</strong> is the time when the last complete run ended.</li>
<li><strong>Agent Last Run Process ID (PID)</strong> is the process ID of the agent at the time of its last complete run. This should only change if the agent is restarted.</li>
<li><strong>Agent Last Run Log GUID</strong> is a globally unique ID used to identify a run in the logs. You can grep the <a class="reference internal" href="#psconfig-maddash-agent-troubleshoot-logs"><em>log file</em></a> with this ID to get the information about a specific run.</li>
<li><strong>Total grids managed by agent</strong> is the number of pSConfig <em>task</em> objects that match a grid configured by the agent from all input sources.</li>
<li><strong>From include files</strong> is the number of pSConfig <em>task</em> objects that match a grid configured by the agent that come from templates in the template include directory. Directly underneath that is a breakdown of the task count by the file from which they originate.</li>
<li><strong>From remote definitions</strong> is a count of the number of pSConfig <em>task</em> objects that match a grid configured by the agent that come from URLs added using the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">remote</span></tt> command. Underneath is a breakdown of the task count by URL.</li>
</ul>
<p>This command is useful as a quick health check of the agent. It can answer questions like:</p>
<ul class="simple">
<li>When did my agent last run?</li>
<li>What templates is it using?</li>
<li>Is it building the expected set of grids?</li>
</ul>
<p>Also, if it throws an error that can be useful information too. In particular the output below is a good sign that your agent has never ran since it has not created the necessary log file:</p>
<div class="highlight-python"><div class="highlight"><pre>Unable to open /var/log/maddash/psconfig-maddash-agent.log: No such file or directory
</pre></div>
</div>
<p>This script may not give all the answers, but will hopefully get things started when debugging unexpected behavior of the agent.</p>
</div>
<div class="section" id="reading-the-logs">
<span id="psconfig-maddash-agent-troubleshoot-logs"></span><h3>Reading the Logs<a class="headerlink" href="#reading-the-logs" title="Permalink to this headline">¶</a></h3>
<p>If you need to debug beyond what the utilities above provide from the logs, then you can manually look at the log files. There us one primary log used by the agent:</p>
<blockquote>
<div><ul class="simple">
<li>The <strong>agent log</strong> lives at <tt class="docutils literal"><span class="pre">/var/log/maddash/psconfig-maddash-agent.log</span></tt> and tracks basic information about agent activity and any errors encountered. A symlink can also be found at <tt class="docutils literal"><span class="pre">/var/log/perfsonar/psconfig-maddash-agent.log</span></tt> for convenience.</li>
</ul>
</div></blockquote>
<p>The log is designed to by highly parsable with fields in the form of <tt class="docutils literal"><span class="pre">key=value</span></tt> separated by whitespace. Every line has a <tt class="docutils literal"><span class="pre">guid=</span></tt> field with an ID unique to the run of an agent. As an example, the GUID can be used for filtering log lines with <tt class="docutils literal"><span class="pre">grep</span></tt> or similar tools.  It is often easiest to run the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">mddash-stats</span></tt> <a class="reference internal" href="#psconfig-maddash-agent-troubleshoot-stats"><em>command</em></a> to get the GUID of the last run as a launching point to parse the log. For example, looking at the example output from <a class="reference internal" href="#psconfig-maddash-agent-troubleshoot-stats"><em>Looking at the last run with psconfig maddash-stats</em></a>, the run had a GUID of <tt class="docutils literal"><span class="pre">BF30C416-489E-11E8-8BB6-530A118410B6</span></tt>. Knowing this GUID, all the log messages associated with that run can be queried using a command like the following:</p>
<div class="highlight-python"><div class="highlight"><pre>grep &quot;guid=BF30C416-489E-11E8-8BB6-530A118410B6&quot; /var/log/maddash/psconfig-maddash-agent.log
</pre></div>
</div>
<p>You can further filter that output if needed, and hopefully eventually find the information needed to solve any issues encountered.</p>
</div>
</div>
<div class="section" id="advanced-configuration">
<span id="psconfig-maddash-agent-advanced"></span><h2>Advanced Configuration<a class="headerlink" href="#advanced-configuration" title="Permalink to this headline">¶</a></h2>
<p>The primary configuration file for the agent lives in <tt class="docutils literal"><span class="pre">/etc/perfsonar/psconfig/maddash-agent.json</span></tt>. Generally you should not have to edit that file directly, but if you are interested in the full set of options available, then see the <a class="reference external" href="https://raw.githubusercontent.com/perfsonar/psconfig/master/doc/psconfig-maddash-agent-schema.json">schema file</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section will be expanded upon the completion of a command-line tool to aid in configuration.</p>
</div>
</div>
<div class="section" id="further-reading">
<span id="psconfig-maddash-agent-reading"></span><h2>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>For a full listing of pSConfig MaDDash Agent related files see the reference <a class="reference internal" href="config_files.html#config-files-psconfig"><em>here</em></a></li>
<li>For information regarding dynamic templates and how they relate to the pSConfig MaDDash Agent see <a class="reference internal" href="psconfig_autoconfig.html"><em>pSConfig Auto-Configuration</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <nav id="channelNav" class="channelNav">
                
                <ul>
<li><a class="reference internal" href="#">Running the pSConfig MaDDash Agent</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#psconfig-maddash-agent-s-role">pSConfig MaDDash Agent&#8217;s Role</a></li>
<li><a class="reference internal" href="#reading-and-modifying-templates">Reading and Modifying Templates</a></li>
<li><a class="reference internal" href="#determining-how-to-display-tasks">Determining How to Display Tasks</a></li>
<li><a class="reference internal" href="#generating-the-maddash-yaml-file">Generating the <tt class="docutils literal"><span class="pre">maddash.yaml</span></tt> file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#installing-the-standalone-package">Installing the Standalone Package</a></li>
<li><a class="reference internal" href="#installing-as-part-of-a-bundle">Installing as Part of a Bundle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-psconfig-maddash-agent">Running <tt class="docutils literal"><span class="pre">psconfig-maddash-agent</span></tt></a><ul>
<li><a class="reference internal" href="#starting-psconfig-maddash-agent">Starting <tt class="docutils literal"><span class="pre">psconfig-maddash-agent</span></tt></a></li>
<li><a class="reference internal" href="#stopping-psconfig-maddash-agent">Stopping <tt class="docutils literal"><span class="pre">psconfig-maddash-agent</span></tt></a></li>
<li><a class="reference internal" href="#restarting-psconfig-maddash-agent">Restarting <tt class="docutils literal"><span class="pre">psconfig-maddash-agent</span></tt></a></li>
<li><a class="reference internal" href="#checking-the-status-of-psconfig-maddash-agent">Checking the status of <tt class="docutils literal"><span class="pre">psconfig-maddash-agent</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-templates">Configuring Templates</a><ul>
<li><a class="reference internal" href="#configuration-basics">Configuration Basics</a></li>
<li><a class="reference internal" href="#remote-templates">Remote Templates</a></li>
<li><a class="reference internal" href="#local-templates">Local Templates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modifying-templates">Modifying Templates</a></li>
<li><a class="reference internal" href="#configuring-grids">Configuring Grids</a><ul>
<li><a class="reference internal" href="#what-is-a-grid">What is a grid?</a></li>
<li><a class="reference internal" href="#introduction-to-the-psconfig-maddash-grid-command">Introduction to the <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">maddash-grid</span></tt> command</a></li>
<li><a class="reference internal" href="#determining-check-plug-ins-installed">Determining Check Plug-ins Installed</a></li>
<li><a class="reference internal" href="#determining-visualization-plug-ins-installed">Determining Visualization Plug-ins Installed</a></li>
<li><a class="reference internal" href="#adjusting-grid-thresholds-and-other-parameters">Adjusting Grid Thresholds and Other Parameters</a></li>
<li><a class="reference internal" href="#understanding-grid-priorities">Understanding Grid Priorities</a></li>
<li><a class="reference internal" href="#controlling-the-display-name">Controlling the Display Name</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#looking-at-the-last-run-with-psconfig-maddash-stats">Looking at the last run with <tt class="docutils literal"><span class="pre">psconfig</span> <span class="pre">maddash-stats</span></tt></a></li>
<li><a class="reference internal" href="#reading-the-logs">Reading the Logs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-configuration">Advanced Configuration</a></li>
<li><a class="reference internal" href="#further-reading">Further Reading</a></li>
</ul>
</li>
</ul>

                <ul>
                  <li>
                  <a href="psconfig_pscheduler_agent.html">Previous topic</a>
                  <ul><li><a href="psconfig_pscheduler_agent.html" title="previous chapter">Running the pSConfig pScheduler Agent</a></li></ul>
                  </li>
                </ul>
                  <ul>
                      <li>
                      <a href="mca.html">Next topic</a>
                      <ul><li><a href="mca.html" title="next chapter">pSConfig Administrative GUI</a></li></ul>
                      </li>
                  </ul>
                
                
            </nav>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="mca.html" title="pSConfig Administrative GUI"
             >next</a> |</li>
        <li class="right" >
          <a href="psconfig_pscheduler_agent.html" title="Running the pSConfig pScheduler Agent"
             >previous</a> |</li>
        <li><a href="index.html">perfSONAR Toolkit 4.1b1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <footer id="fat">
        <div class="footerContents">
            <nav id="fatFooterNav" class="fatFooterNav">
                <ul id="menu-partners" class="menu depth-0">
                    <li id="footer-partner-text" class="partner-menu">
                        perfSONAR 
                        <br>
                        partners 
                        <br>
                        include: 
                    </li>
    
                <li id="footer-partner-esnet" class="partner-menu">
                    <a href="http://www.es.net/" title="Visit DOE's Energy Sciences Network"><img src="_static/ESnet-ps.png" alt="" style="border:none;"></a> </li>
                
                <li id="footer-partner-geant" class="partner-menu">
                    <a href="http://www.geant.org/" title="Visit GEANT"><img src="_static/geant-ps.png" alt="" style="border:none;"/></a> </li>
        
                <li id="footer-partner-iu" class="partner-menu">
                    <a href="http://www.iu.edu/" title="Visit Indiana University"><img src="_static/IU-ps.png" alt="" style="border:none;"></a> </li>

                <li id="footer-partner-i2" class="partner-menu">
                    <a href="http://www.internet2.edu/" title="Visit Internet2"><img src="_static/I2-ps.png" alt="" style="border:none;"></a> </li>
                
                <li id="footer-partner-um" class="partner-menu">
                    <a href="http://www.umich.edu/" title="Visit University of Michigan"><img src="_static/UM-ps.png" alt="" style="border:none;"></a> </li>

                </ul>

            </nav>
            <nav id="minFooterNav" class="minFooterNav">
                <span class="copyright">PERFormance Service Oriented Network monitoring ARchitecture </span>
            </nav>
          
        </div> <!-- /footerContents -->
    </footer>
    
    <div class="footer">
        &copy; Copyright 2018, perfSONAR Project.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>